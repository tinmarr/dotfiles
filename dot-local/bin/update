#!/usr/bin/env bash

sudo test
mirrors
yay -Syy
yay -Qu > $HOME/.cache/updated-packages.txt
echo "Starting update:"
yay -Syu --answerclean N --answerdiff N --removemake --noconfirm

ZINIT="$HOME/.local/share/zinit/zinit.git/zinit.zsh"
if [[ -e $ZINIT ]]; then
    zsh -c "
        source "$ZINIT" && \
        zinit self-update && \
        zinit update --parallel
    "
fi

cd ~/dotfiles
git pull
restowall
cd ~

if [[ -e /usr/bin/hyprpm ]]; then
    hyprpm update
fi

yay
echo "Orphans:"
yay -Qdt
echo "If there are orphans, remove with:"
echo "    yay -Qdtq | sudo pacman -Rns -"
echo "Not done automatically because this could break stuff"
echo "$(cat $HOME/.cache/updated-packages.txt | wc -l) packages updated"
echo "Updated packages stored in ~/.cache/updated-packages.txt"

